/**
 * OverType v1.0.0
 * A lightweight markdown editor library with perfect WYSIWYG alignment
 * @license MIT
 * @author Demo User
 * https://github.com/demo/overtype
 */
var OverType=(()=>{var $=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var Ee=Object.getOwnPropertyNames;var Be=Object.prototype.hasOwnProperty;var Ae=(t,e,n)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Te=(t,e)=>()=>(t&&(e=t(t=0)),e);var N=(t,e)=>{for(var n in e)$(t,n,{get:e[n],enumerable:!0})},Ie=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ee(e))!Be.call(t,o)&&o!==n&&$(t,o,{get:()=>e[o],enumerable:!(r=Ce(e,o))||r.enumerable});return t};var $e=t=>Ie($({},"__esModule",{value:!0}),t);var B=(t,e,n)=>(Ae(t,typeof e!="symbol"?e+"":e,n),n);var P={};N(P,{applyCustomFormat:()=>Se,default:()=>Ue,expandSelection:()=>xe,getActiveFormats:()=>we,hasFormat:()=>ke,insertHeader:()=>be,insertLink:()=>fe,preserveSelection:()=>ce,setUndoMethod:()=>pe,toggleBold:()=>ue,toggleBulletList:()=>ge,toggleCode:()=>me,toggleItalic:()=>he,toggleNumberedList:()=>ve,toggleQuote:()=>ye});function He(){return{prefix:"",suffix:"",blockPrefix:"",blockSuffix:"",multiline:!1,replaceNext:"",prefixSpace:!1,scanFor:"",surroundWithNewlines:!1,orderedList:!1,unorderedList:!1,trimFirst:!1}}function Pe(t){return j(j({},He()),t)}function _(t){return t.trim().split(`
`).length>1}function ie(t,e){return Array(e+1).join(t)}function ze(t,e){let n=e;for(;t[n]&&t[n-1]!=null&&!t[n-1].match(/\s/);)n--;return n}function Fe(t,e,n){let r=e,o=n?/\n/:/\s/;for(;t[r]&&!t[r].match(o);)r++;return r}function le(t){let e=t.value.split(`
`),n=0;for(let r=0;r<e.length;r++){let o=e[r].length+1;t.selectionStart>=n&&t.selectionStart<n+o&&(t.selectionStart=n),t.selectionEnd>=n&&t.selectionEnd<n+o&&(t.selectionEnd=n+o-1),n+=o}}function Ve(t,e,n,r=!1){if(t.selectionStart===t.selectionEnd)t.selectionStart=ze(t.value,t.selectionStart),t.selectionEnd=Fe(t.value,t.selectionEnd,r);else{let o=t.selectionStart-e.length,i=t.selectionEnd+n.length,s=t.value.slice(o,t.selectionStart)===e,a=t.value.slice(t.selectionEnd,i)===n;s&&a&&(t.selectionStart=o,t.selectionEnd=i)}return t.value.slice(t.selectionStart,t.selectionEnd)}function H(t){let e=t.value.slice(0,t.selectionStart),n=t.value.slice(t.selectionEnd),r=e.match(/\n*$/),o=n.match(/^\n*/),i=r?r[0].length:0,s=o?o[0].length:0,a,l;return e.match(/\S/)&&i<2&&(a=ie(`
`,2-i)),n.match(/\S/)&&s<2&&(l=ie(`
`,2-s)),a==null&&(a=""),l==null&&(l=""),{newlinesToAppend:a,newlinesToPrepend:l}}function ce(t,e){let n=t.selectionStart,r=t.selectionEnd,o=t.scrollTop;e(),t.selectionStart=n,t.selectionEnd=r,t.scrollTop=o}function Ne(t,{text:e,selectionStart:n,selectionEnd:r}){let o=t.selectionStart,i=t.value.slice(0,o),s=t.value.slice(t.selectionEnd);if(k===null||k===!0){t.contentEditable="true";try{k=document.execCommand("insertText",!1,e)}catch(a){k=!1}t.contentEditable="false"}if(k&&!t.value.slice(0,t.selectionStart).endsWith(e)&&(k=!1),!k){try{document.execCommand("ms-beginUndoUnit")}catch(a){}t.value=i+e+s;try{document.execCommand("ms-endUndoUnit")}catch(a){}t.dispatchEvent(new CustomEvent("input",{bubbles:!0,cancelable:!0}))}n!=null&&r!=null?t.setSelectionRange(n,r):t.setSelectionRange(o,t.selectionEnd)}function pe(t){t==="native"?k=!0:t==="manual"?k=!1:k=null}function Re(t,e){let n,r,{prefix:o,suffix:i,blockPrefix:s,blockSuffix:a,replaceNext:l,prefixSpace:m,scanFor:c,surroundWithNewlines:h}=e,g=t.selectionStart,b=t.selectionEnd,p=t.value.slice(t.selectionStart,t.selectionEnd),u=_(p)&&s.length>0?`${s}
`:o,v=_(p)&&a.length>0?`
${a}`:i;if(m){let y=t.value[t.selectionStart-1];t.selectionStart!==0&&y!=null&&!y.match(/\s/)&&(u=` ${u}`)}p=Ve(t,u,v,e.multiline);let f=t.selectionStart,w=t.selectionEnd,Le=l.length>0&&v.indexOf(l)>-1&&p.length>0;if(h){let y=H(t);n=y.newlinesToAppend,r=y.newlinesToPrepend,u=n+o,v+=r}if(p.startsWith(u)&&p.endsWith(v)){let y=p.slice(u.length,p.length-v.length);if(g===b){let x=g-u.length;x=Math.max(x,f),x=Math.min(x,f+y.length),f=w=x}else w=f+y.length;return{text:y,selectionStart:f,selectionEnd:w}}else if(Le)if(c.length>0&&p.match(c)){v=v.replace(l,p);let y=u+p+v;return f=w=f+u.length,{text:y,selectionStart:f,selectionEnd:w}}else{let y=u+p+v;return f=f+u.length+p.length+v.indexOf(l),w=f+l.length,{text:y,selectionStart:f,selectionEnd:w}}else{let y=u+p+v;f=g+u.length,w=b+u.length;let x=p.match(/^\s*|\s*$/g);if(e.trimFirst&&x){let F=x[0]||"",V=x[1]||"";y=F+u+p.trim()+v+V,f+=F.length,w-=V.length}return{text:y,selectionStart:f,selectionEnd:w}}}function We(t,e){let{prefix:n,suffix:r,surroundWithNewlines:o}=e,i=t.value.slice(t.selectionStart,t.selectionEnd),s=t.selectionStart,a=t.selectionEnd,l=i.split(`
`);if(l.every(c=>c.startsWith(n)&&c.endsWith(r)))i=l.map(c=>c.slice(n.length,c.length-r.length)).join(`
`),a=s+i.length;else if(i=l.map(c=>n+c+r).join(`
`),o){let{newlinesToAppend:c,newlinesToPrepend:h}=H(t);s+=c.length,a=s+i.length,i=c+i+h}return{text:i,selectionStart:s,selectionEnd:a}}function se(t){let e=t.split(`
`),n=/^\d+\.\s+/,r=e.every(i=>n.test(i)),o=e;return r&&(o=e.map(i=>i.replace(n,""))),{text:o.join(`
`),processed:r}}function ae(t){let e=t.split(`
`),n="- ",r=e.every(i=>i.startsWith(n)),o=e;return r&&(o=e.map(i=>i.slice(n.length,i.length))),{text:o.join(`
`),processed:r}}function I(t,e){return e?"- ":`${t+1}. `}function qe(t,e){let n,r,o;return t.orderedList?(r=se(e),n=ae(r.text),o=n.text):(r=ae(e),n=se(r.text),o=n.text),[r,n,o]}function De(t,e){let n=t.selectionStart===t.selectionEnd,r=t.selectionStart,o=t.selectionEnd;le(t);let i=t.value.slice(t.selectionStart,t.selectionEnd),[s,a,l]=qe(e,i),m=l.split(`
`).map((u,v)=>`${I(v,e.unorderedList)}${u}`),c=m.reduce((u,v,f)=>u+I(f,e.unorderedList).length,0),h=m.reduce((u,v,f)=>u+I(f,!e.unorderedList).length,0);if(s.processed)return n?(r=Math.max(r-I(0,e.unorderedList).length,0),o=r):(r=t.selectionStart,o=t.selectionEnd-c),{text:l,selectionStart:r,selectionEnd:o};let{newlinesToAppend:g,newlinesToPrepend:b}=H(t),p=g+m.join(`
`)+b;return n?(r=Math.max(r+I(0,e.unorderedList).length+g.length,0),o=r):a.processed?(r=Math.max(t.selectionStart+g.length,0),o=t.selectionEnd+g.length+c-h):(r=Math.max(t.selectionStart+g.length,0),o=t.selectionEnd+g.length+c),{text:p,selectionStart:r,selectionEnd:o}}function Ke(t,e){let n=t.value.slice(t.selectionStart,t.selectionEnd),r;e.orderedList||e.unorderedList?r=De(t,e):e.multiline&&_(n)?r=We(t,e):r=Re(t,e),Ne(t,r)}function de(t){if(!t)return[];let e=[],{selectionStart:n,selectionEnd:r,value:o}=t,i=o.split(`
`),s=0,a="";for(let h of i){if(n>=s&&n<=s+h.length){a=h;break}s+=h.length+1}a.startsWith("- ")&&(a.startsWith("- [ ] ")||a.startsWith("- [x] ")?e.push("task-list"):e.push("bullet-list")),/^\d+\.\s/.test(a)&&e.push("numbered-list"),a.startsWith("> ")&&e.push("quote"),a.startsWith("# ")&&e.push("header"),a.startsWith("## ")&&e.push("header-2"),a.startsWith("### ")&&e.push("header-3");let l=Math.max(0,n-10),m=Math.min(o.length,r+10),c=o.slice(l,m);if(c.includes("**")){let h=o.slice(Math.max(0,n-100),n),g=o.slice(r,Math.min(o.length,r+100)),b=h.lastIndexOf("**"),p=g.indexOf("**");b!==-1&&p!==-1&&e.push("bold")}if(c.includes("_")){let h=o.slice(Math.max(0,n-100),n),g=o.slice(r,Math.min(o.length,r+100)),b=h.lastIndexOf("_"),p=g.indexOf("_");b!==-1&&p!==-1&&e.push("italic")}if(c.includes("`")){let h=o.slice(Math.max(0,n-100),n),g=o.slice(r,Math.min(o.length,r+100));h.includes("`")&&g.includes("`")&&e.push("code")}if(c.includes("[")&&c.includes("]")){let h=o.slice(Math.max(0,n-100),n),g=o.slice(r,Math.min(o.length,r+100)),b=h.lastIndexOf("["),p=g.indexOf("]");b!==-1&&p!==-1&&o.slice(r+p+1,r+p+10).startsWith("(")&&e.push("link")}return e}function Ze(t,e){return de(t).includes(e)}function C(t,e){let n=Pe(e);t.focus(),Ke(t,n)}function ue(t){!t||t.disabled||t.readOnly||C(t,S.bold)}function he(t){!t||t.disabled||t.readOnly||C(t,S.italic)}function me(t){!t||t.disabled||t.readOnly||C(t,S.code)}function fe(t,e={}){if(!t||t.disabled||t.readOnly)return;let n=j({},S.link);if(e.url&&(n.suffix=`](${e.url})`,n.replaceNext=""),e.text&&!t.value.slice(t.selectionStart,t.selectionEnd)){let r=t.selectionStart;t.value=t.value.slice(0,r)+e.text+t.value.slice(r),t.selectionStart=r,t.selectionEnd=r+e.text.length}C(t,n)}function ge(t){!t||t.disabled||t.readOnly||C(t,S.bulletList)}function ve(t){!t||t.disabled||t.readOnly||C(t,S.numberedList)}function ye(t){!t||t.disabled||t.readOnly||C(t,S.quote)}function be(t,e=1){if(!t||t.disabled||t.readOnly)return;(e<1||e>6)&&(e=1);let n=`header${e}`,r=S[n]||S.header1,o=t.value,i=t.selectionStart,s=i,a=i;for(;s>0&&o[s-1]!==`
`;)s--;for(;a<o.length&&o[a]!==`
`;)a++;t.selectionStart=s,t.selectionEnd=a;let m=o.slice(s,a).replace(/^#{1,6}\s*/,""),c=r.prefix+m,h=t.selectionStart;t.value=o.slice(0,s)+c+o.slice(a),t.selectionStart=s+r.prefix.length,t.selectionEnd=s+c.length}function we(t){return de(t)}function ke(t,e){return Ze(t,e)}function xe(t,e={}){if(!t)return;let{toWord:n,toLine:r}=e,{selectionStart:o,selectionEnd:i,value:s}=t;if(r)le(t);else if(n&&o===i){let a=o,l=i;for(;a>0&&!/\s/.test(s[a-1]);)a--;for(;l<s.length&&!/\s/.test(s[l]);)l++;t.selectionStart=a,t.selectionEnd=l}}function Se(t,e){!t||t.disabled||t.readOnly||C(t,e)}var Oe,re,je,_e,oe,j,k,S,Ue,z=Te(()=>{Oe=Object.defineProperty,re=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable,oe=(t,e,n)=>e in t?Oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,j=(t,e)=>{for(var n in e||(e={}))je.call(e,n)&&oe(t,n,e[n]);if(re)for(var n of re(e))_e.call(e,n)&&oe(t,n,e[n]);return t};k=null;S={bold:{prefix:"**",suffix:"**",trimFirst:!0},italic:{prefix:"_",suffix:"_",trimFirst:!0},code:{prefix:"`",suffix:"`",blockPrefix:"```",blockSuffix:"```"},link:{prefix:"[",suffix:"](url)",replaceNext:"url",scanFor:"https?://"},quote:{prefix:"> ",multiline:!0,surroundWithNewlines:!0},bulletList:{prefix:"- ",multiline:!0,unorderedList:!0},numberedList:{prefix:"1. ",multiline:!0,orderedList:!0},header1:{prefix:"# "},header2:{prefix:"## "},header3:{prefix:"### "},header4:{prefix:"#### "},header5:{prefix:"##### "},header6:{prefix:"###### "}};Ue={toggleBold:ue,toggleItalic:he,toggleCode:me,insertLink:fe,toggleBulletList:ge,toggleNumberedList:ve,toggleQuote:ye,insertHeader:be,getActiveFormats:we,hasFormat:ke,expandSelection:xe,applyCustomFormat:Se,preserveSelection:ce,setUndoMethod:pe}});var Qe={};N(Qe,{OverType:()=>L,default:()=>Ge});var A=class{static escapeHtml(e){let n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,r=>n[r])}static preserveIndentation(e,n){let o=n.match(/^(\s*)/)[1].replace(/ /g,"&nbsp;");return e.replace(/^\s*/,o)}static parseHeader(e){return e.replace(/^(#{1,3})\s(.+)$/,(n,r,o)=>{let i=r.length;return`<span class="header ${["h1","h2","h3"][i-1]}"><span class="syntax-marker">${r}</span> ${o}</span>`})}static parseHorizontalRule(e){return e.match(/^(-{3,}|\*{3,}|_{3,})$/)?`<div><span class="hr-marker">${e}</span></div>`:null}static parseBlockquote(e){return e.replace(/^&gt; (.+)$/,(n,r)=>`<span class="blockquote"><span class="syntax-marker">&gt;</span> ${r}</span>`)}static parseBulletList(e){return e.replace(/^((?:&nbsp;)*)([-*])\s(.+)$/,(n,r,o,i)=>`${r}<span class="syntax-marker">${o}</span> ${i}`)}static parseNumberedList(e){return e.replace(/^((?:&nbsp;)*)(\d+\.)\s(.+)$/,(n,r,o,i)=>`${r}<span class="syntax-marker">${o}</span> ${i}`)}static parseCodeBlock(e){return e.startsWith("```")?`<div><span class="code-fence">${e}</span></div>`:null}static parseBold(e){return e=e.replace(/\*\*(.+?)\*\*/g,'<strong><span class="syntax-marker">**</span>$1<span class="syntax-marker">**</span></strong>'),e=e.replace(/__(.+?)__/g,'<strong><span class="syntax-marker">__</span>$1<span class="syntax-marker">__</span></strong>'),e}static parseItalic(e){return e=e.replace(new RegExp("(?<!\\*)\\*(?!\\*)(.+?)(?<!\\*)\\*(?!\\*)","g"),'<em><span class="syntax-marker">*</span>$1<span class="syntax-marker">*</span></em>'),e=e.replace(new RegExp("(?<!_)_(?!_)(.+?)(?<!_)_(?!_)","g"),'<em><span class="syntax-marker">_</span>$1<span class="syntax-marker">_</span></em>'),e}static parseInlineCode(e){return e.replace(/`(.+?)`/g,'<code><span class="syntax-marker">`</span>$1<span class="syntax-marker">`</span></code>')}static parseLinks(e){return e.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2"><span class="syntax-marker">[</span>$1<span class="syntax-marker">](</span><span class="syntax-marker">$2</span><span class="syntax-marker">)</span></a>')}static parseInlineElements(e){let n=e;return n=this.parseInlineCode(n),n=this.parseLinks(n),n=this.parseBold(n),n=this.parseItalic(n),n}static parseLine(e){let n=this.escapeHtml(e);n=this.preserveIndentation(n,e);let r=this.parseHorizontalRule(n);if(r)return r;let o=this.parseCodeBlock(n);return o||(n=this.parseHeader(n),n=this.parseBlockquote(n),n=this.parseBulletList(n),n=this.parseNumberedList(n),n=this.parseInlineElements(n),n.trim()===""?"<div>&nbsp;</div>":`<div>${n}</div>`)}static parse(e,n=-1,r=!1){return e.split(`
`).map((s,a)=>r&&a===n?`<div class="raw-line">${this.escapeHtml(s)||"&nbsp;"}</div>`:this.parseLine(s)).join("")}};var T=class{constructor(e){this.editor=e,this.textarea=e.textarea,this.shortcuts=new Map,this.registerDefaults()}registerDefaults(){this.register("b",!1,()=>{this.wrapSelection("**")}),this.register("i",!1,()=>{this.wrapSelection("*")}),this.register("8",!0,()=>{this.toggleList("bullet")}),this.register("7",!0,()=>{this.toggleList("number")}),this.register("k",!1,()=>{this.wrapSelection("`")}),this.register("k",!0,()=>{this.insertLink()})}register(e,n,r){let o=`${n?"shift+":""}${e.toLowerCase()}`;this.shortcuts.set(o,r)}handleKeydown(e){if(!(navigator.platform.toLowerCase().includes("mac")?e.metaKey:e.ctrlKey))return!1;let o=`${e.shiftKey?"shift+":""}${e.key.toLowerCase()}`,i=this.shortcuts.get(o);return i?(e.preventDefault(),i.call(this),!0):!1}wrapSelection(e,n=e){let r=this.textarea.selectionStart,o=this.textarea.selectionEnd,s=this.textarea.value.slice(r,o);if(s.startsWith(e)&&s.endsWith(n)&&s.length>=e.length+n.length){let a=s.slice(e.length,s.length-n.length);this.textarea.setRangeText(a,r,o,"end"),this.editor.updatePreview();return}this.textarea.setRangeText(e+s+n,r,o,"end"),this.editor.updatePreview()}toggleList(e){let n=this.textarea.value,r=this.textarea.selectionStart,o=this.textarea.selectionEnd,i=n.lastIndexOf(`
`,r-1)+1,s=n.indexOf(`
`,o)===-1?n.length:n.indexOf(`
`,o),l=n.slice(i,s).split(`
`),m;e==="bullet"?m=l.map(c=>/^\s*[-*]\s+/.test(c)?c.replace(/^(\s*)[-*]\s+/,"$1"):c.replace(/^(\s*)/,"$1- ")).join(`
`):e==="number"&&(m=l.map((c,h)=>/^\s*\d+\.\s+/.test(c)?c.replace(/^(\s*)\d+\.\s+/,"$1"):c.replace(/^(\s*)/,`$1${h+1}. `)).join(`
`)),this.textarea.setRangeText(m,i,s,"end"),this.editor.updatePreview()}insertLink(){let e=this.textarea.selectionStart,n=this.textarea.selectionEnd,r=this.textarea.value.slice(e,n),o=r||"link text",i=`[${o}](url)`;if(this.textarea.setRangeText(i,e,n,"end"),!r)this.textarea.setSelectionRange(e+1,e+1+o.length);else{let s=e+i.indexOf("(url)")+1;this.textarea.setSelectionRange(s,s+3)}this.editor.updatePreview(),this.textarea.focus()}insertHeader(e){let n=this.textarea.value,r=this.textarea.selectionStart,o=n.lastIndexOf(`
`,r-1)+1,i=n.indexOf(`
`,r)===-1?n.length:n.indexOf(`
`,r),s=n.slice(o,i),a=s.match(/^(#{1,3})\s/);if(a)if(a[1].length===e){let l=s.replace(/^#{1,3}\s/,"");this.textarea.setRangeText(l,o,i,"end")}else{let l=s.replace(/^#{1,3}/,"#".repeat(e));this.textarea.setRangeText(l,o,i,"end")}else{let l="#".repeat(e)+" "+s;this.textarea.setRangeText(l,o,i,"end")}this.editor.updatePreview()}destroy(){this.shortcuts.clear()}};var E={name:"solar",colors:{bgPrimary:"#faf0ca",bgSecondary:"#ffffff",text:"#0d3b66",h1:"#f95738",h2:"#ee964b",h3:"#3d8a51",strong:"#ee964b",em:"#f95738",link:"#0d3b66",code:"#0d3b66",codeBg:"rgba(244, 211, 94, 0.4)",blockquote:"#5a7a9b",hr:"#5a7a9b",syntaxMarker:"rgba(13, 59, 102, 0.52)",cursor:"#f95738",selection:"rgba(244, 211, 94, 0.4)",listMarker:"#ee964b"}},R={name:"cave",colors:{bgPrimary:"#141E26",bgSecondary:"#1D2D3E",text:"#c5dde8",h1:"#d4a5ff",h2:"#f6ae2d",h3:"#9fcfec",strong:"#f6ae2d",em:"#9fcfec",link:"#9fcfec",code:"#c5dde8",codeBg:"#1a232b",blockquote:"#9fcfec",hr:"#c5dde8",syntaxMarker:"rgba(159, 207, 236, 0.73)",cursor:"#f26419",selection:"rgba(51, 101, 138, 0.4)",listMarker:"#f6ae2d"}},W={solar:E,cave:R,light:E,dark:R};function M(t){return typeof t=="string"?{...W[t]||W.solar,name:t}:t}function q(t){let e=[];for(let[n,r]of Object.entries(t)){let o=n.replace(/([A-Z])/g,"-$1").toLowerCase();e.push(`--${o}: ${r};`)}return e.join(`
`)}function D(t,e={}){return{...t,colors:{...t.colors,...e}}}function K(t={}){let{fontSize:e="14px",lineHeight:n=1.6,fontFamily:r="'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace",padding:o="20px",theme:i=null,mobile:s={}}=t,a=Object.keys(s).length>0?`
    @media (max-width: 640px) {
      .overtype-wrapper .overtype-input,
      .overtype-wrapper .overtype-preview {
        ${Object.entries(s).map(([m,c])=>`${m.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${c} !important;`).join(`
        `)}
      }
    }
  `:"",l=i&&i.colors?q(i.colors):"";return`
    /* OverType Editor Styles */
    .overtype-wrapper {
      position: relative !important;
      width: 100% !important;
      height: 100% !important;
      overflow: hidden !important;
      background: var(--bg-secondary, #ffffff) !important;
      ${l?`
      /* Theme Variables */
      ${l}`:""}
    }

    /* Critical alignment styles - must be identical for both layers */
    .overtype-wrapper .overtype-input,
    .overtype-wrapper .overtype-preview {
      /* Positioning - must be identical */
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      
      /* Font properties - any difference breaks alignment */
      font-family: ${r} !important;
      font-size: var(--instance-font-size, ${e}) !important;
      line-height: var(--instance-line-height, ${n}) !important;
      font-weight: normal !important;
      font-style: normal !important;
      font-variant: normal !important;
      font-stretch: normal !important;
      font-kerning: none !important;
      font-feature-settings: normal !important;
      
      /* Box model - must match exactly */
      padding: var(--instance-padding, ${o}) !important;
      margin: 0 !important;
      border: none !important;
      outline: none !important;
      box-sizing: border-box !important;
      
      /* Text layout - critical for character positioning */
      white-space: pre-wrap !important;
      word-wrap: break-word !important;
      word-break: normal !important;
      overflow-wrap: break-word !important;
      tab-size: 2 !important;
      -moz-tab-size: 2 !important;
      text-align: left !important;
      text-indent: 0 !important;
      letter-spacing: normal !important;
      word-spacing: normal !important;
      
      /* Text rendering */
      text-transform: none !important;
      text-rendering: auto !important;
      -webkit-font-smoothing: auto !important;
      -webkit-text-size-adjust: 100% !important;
      
      /* Direction and writing */
      direction: ltr !important;
      writing-mode: horizontal-tb !important;
      unicode-bidi: normal !important;
      text-orientation: mixed !important;
      
      /* Visual effects that could shift perception */
      text-shadow: none !important;
      filter: none !important;
      transform: none !important;
      zoom: 1 !important;
      
      /* Vertical alignment */
      vertical-align: baseline !important;
      
      /* Size constraints */
      min-width: 0 !important;
      min-height: 0 !important;
      max-width: none !important;
      max-height: none !important;
      
      /* Overflow */
      overflow-y: auto !important;
      overflow-x: auto !important;
      scrollbar-width: auto !important;
      scrollbar-gutter: auto !important;
      
      /* Animation/transition - disabled to prevent movement */
      animation: none !important;
      transition: none !important;
    }

    /* Input layer styles */
    .overtype-wrapper .overtype-input {
      /* Layer positioning */
      z-index: 1 !important;
      
      /* Text visibility */
      color: transparent !important;
      caret-color: var(--cursor, #f95738) !important;
      background-color: transparent !important;
      
      /* Textarea-specific */
      resize: none !important;
      appearance: none !important;
      -webkit-appearance: none !important;
      -moz-appearance: none !important;
      
      /* Prevent mobile zoom on focus */
      touch-action: manipulation !important;
      
      /* Disable autofill and spellcheck */
      autocomplete: off !important;
      autocorrect: off !important;
      autocapitalize: off !important;
      spellcheck: false !important;
    }

    .overtype-wrapper .overtype-input::selection {
      background-color: var(--selection, rgba(244, 211, 94, 0.4));
    }

    /* Preview layer styles */
    .overtype-wrapper .overtype-preview {
      /* Layer positioning */
      z-index: 0 !important;
      pointer-events: none !important;
      color: var(--text, #0d3b66) !important;
      background-color: transparent !important;
      
      /* Prevent text selection */
      user-select: none !important;
      -webkit-user-select: none !important;
      -moz-user-select: none !important;
      -ms-user-select: none !important;
    }

    /* Defensive styles for preview child divs */
    .overtype-wrapper .overtype-preview div {
      /* Reset any inherited styles */
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      text-align: left !important;
      text-indent: 0 !important;
      display: block !important;
      position: static !important;
      transform: none !important;
      min-height: 0 !important;
      max-height: none !important;
      line-height: inherit !important;
      font-size: inherit !important;
      font-family: inherit !important;
    }

    /* Markdown element styling - NO SIZE CHANGES */
    .overtype-wrapper .overtype-preview .header {
      font-weight: bold !important;
    }

    /* Header colors */
    .overtype-wrapper .overtype-preview .h1 { 
      color: var(--h1, #f95738) !important; 
    }
    .overtype-wrapper .overtype-preview .h2 { 
      color: var(--h2, #ee964b) !important; 
    }
    .overtype-wrapper .overtype-preview .h3 { 
      color: var(--h3, #3d8a51) !important; 
    }

    /* Bold text */
    .overtype-wrapper .overtype-preview strong {
      color: var(--strong, #ee964b) !important;
      font-weight: bold !important;
    }

    /* Italic text */
    .overtype-wrapper .overtype-preview em {
      color: var(--em, #f95738) !important;
      text-decoration-color: var(--em, #f95738) !important;
      text-decoration-thickness: 1px !important;
      font-style: italic !important;
    }

    /* Inline code */
    .overtype-wrapper .overtype-preview code {
      background: var(--code-bg, rgba(244, 211, 94, 0.4)) !important;
      color: var(--code, #0d3b66) !important;
      padding: 0 !important;
      border-radius: 2px !important;
      font-family: inherit !important;
      font-weight: normal !important;
    }

    /* Code blocks */
    .overtype-wrapper .overtype-preview pre {
      background: #1e1e1e !important;
      padding: 0 !important;
      margin: 0 !important;
      border-radius: 4px !important;
      overflow-x: auto !important;
    }

    .overtype-wrapper .overtype-preview pre code {
      background: none !important;
    }

    /* Blockquotes */
    .overtype-wrapper .overtype-preview .blockquote {
      color: var(--blockquote, #5a7a9b) !important;
      padding: 0 !important;
      margin: 0 !important;
      border: none !important;
    }

    /* Links */
    .overtype-wrapper .overtype-preview a {
      color: var(--link, #0d3b66) !important;
      text-decoration: underline !important;
      font-weight: normal !important;
    }

    .overtype-wrapper .overtype-preview a:hover {
      text-decoration: underline !important;
      color: var(--link, #0d3b66) !important;
    }

    /* Lists - no list styling */
    .overtype-wrapper .overtype-preview ul,
    .overtype-wrapper .overtype-preview ol {
      list-style: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .overtype-wrapper .overtype-preview li {
      margin: 0 !important;
      padding: 0 !important;
      list-style: none !important;
    }

    /* Horizontal rules */
    .overtype-wrapper .overtype-preview hr {
      border: none !important;
      color: var(--hr, #5a7a9b) !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .overtype-wrapper .overtype-preview .hr-marker {
      color: var(--hr, #5a7a9b) !important;
      opacity: 0.6 !important;
    }

    /* Code fence markers - with background when not in code block */
    .overtype-wrapper .overtype-preview .code-fence {
      color: var(--code, #0d3b66) !important;
      background: var(--code-bg, rgba(244, 211, 94, 0.4)) !important;
    }
    
    /* Code block lines - background for entire code block */
    .overtype-wrapper .overtype-preview .code-block-line {
      background: var(--code-bg, rgba(244, 211, 94, 0.4)) !important;
    }
    
    /* Remove background from code fence when inside code block line */
    .overtype-wrapper .overtype-preview .code-block-line .code-fence {
      background: transparent !important;
    }

    /* Raw markdown line */
    .overtype-wrapper .overtype-preview .raw-line {
      color: var(--raw-line, #5a7a9b) !important;
      font-style: normal !important;
      font-weight: normal !important;
    }

    /* Syntax markers */
    .overtype-wrapper .overtype-preview .syntax-marker {
      color: var(--syntax-marker, rgba(13, 59, 102, 0.52)) !important;
      opacity: 0.7 !important;
    }

    /* List markers */
    .overtype-wrapper .overtype-preview .list-marker {
      color: var(--list-marker, #ee964b) !important;
    }

    /* Stats bar */
    .overtype-wrapper.with-stats {
      padding-bottom: 40px !important;
    }
    
    .overtype-wrapper .overtype-stats {
      position: absolute !important;
      bottom: 0 !important;
      left: 0 !important;
      right: 0 !important;
      height: 40px !important;
      padding: 0 20px !important;
      background: #f8f9fa !important;
      border-top: 1px solid #e0e0e0 !important;
      display: flex !important;
      justify-content: space-between !important;
      align-items: center !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
      font-size: 0.85rem !important;
      color: #666 !important;
      z-index: 2 !important;
    }
    
    /* Dark theme stats bar */
    .overtype-wrapper[data-theme="cave"] .overtype-stats {
      background: var(--bg-secondary, #1D2D3E) !important;
      border-top: 1px solid rgba(197, 221, 232, 0.1) !important;
      color: var(--text, #c5dde8) !important;
    }
    
    .overtype-wrapper .overtype-stats .overtype-stat {
      display: flex !important;
      align-items: center !important;
      gap: 5px !important;
      white-space: nowrap !important;
    }
    
    .overtype-wrapper .overtype-stats .live-dot {
      width: 8px !important;
      height: 8px !important;
      background: #4caf50 !important;
      border-radius: 50% !important;
      animation: pulse 2s infinite !important;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.2); }
    }
    
    /* Adjust textarea and preview for stats bar */
    .overtype-wrapper.with-stats .overtype-input,
    .overtype-wrapper.with-stats .overtype-preview {
      height: calc(100% - 40px) !important;
    }

    /* Toolbar Styles */
    .overtype-toolbar {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 8px;
      background: var(--bg-primary, #f8f9fa);
      border: 1px solid var(--border, #e0e0e0);
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .overtype-toolbar-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      border: none;
      border-radius: 6px;
      background: transparent;
      color: var(--text-secondary, #666);
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .overtype-toolbar-button svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }
    
    /* Special sizing for code block icon */
    .overtype-toolbar-button[data-action="insertCodeBlock"] svg {
      width: 24px;
      height: 18px;
      fill: transparent !important;
    }

    .overtype-toolbar-button:hover {
      background: var(--bg-secondary, #e9ecef);
      color: var(--text-primary, #333);
    }

    .overtype-toolbar-button:active {
      transform: scale(0.95);
    }

    .overtype-toolbar-button.active {
      background: var(--primary, #007bff);
      color: white;
    }

    .overtype-toolbar-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .overtype-toolbar-separator {
      width: 1px;
      height: 24px;
      background: var(--border, #e0e0e0);
      margin: 0 4px;
      flex-shrink: 0;
    }

    /* Adjust wrapper when toolbar is present */
    .overtype-toolbar + .overtype-wrapper {
      border-radius: 0 0 8px 8px;
      border-top: none;
    }

    /* Mobile toolbar adjustments */
    @media (max-width: 640px) {
      .overtype-toolbar {
        padding: 6px;
        gap: 2px;
      }

      .overtype-toolbar-button {
        width: 36px;
        height: 36px;
      }

      .overtype-toolbar-separator {
        margin: 0 2px;
      }
    }

    ${a}
  `}var Z=`<svg viewBox="0 0 18 18">
  <path stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"></path>
  <path stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"></path>
</svg>`,U=`<svg viewBox="0 0 18 18">
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="7" x2="13" y1="4" y2="4"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="5" x2="11" y1="14" y2="14"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="8" x2="10" y1="14" y2="4"></line>
</svg>`,G=`<svg viewBox="0 0 18 18">
  <path fill="currentColor" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"></path>
</svg>`,Q=`<svg viewBox="0 0 18 18">
  <path fill="currentColor" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"></path>
</svg>`,J=`<svg viewBox="0 0 18 18">
  <path fill="currentColor" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"></path>
</svg>`,X=`<svg viewBox="0 0 18 18">
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="7" x2="11" y1="7" y2="11"></line>
  <path stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"></path>
  <path stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"></path>
</svg>`,Y=`<svg viewBox="0 0 18 18">
  <polyline stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" points="5 7 3 9 5 11"></polyline>
  <polyline stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" points="13 7 15 9 13 11"></polyline>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="10" x2="8" y1="5" y2="13"></line>
</svg>`,ee=`<svg viewBox="0 0 46 33" fill="transparent" xmlns="http://www.w3.org/2000/svg">
  <path d="M35 8h3a5 5 0 0 1 5 5v12a5 5 0 0 1-5 5H18a5 5 0 0 1-5-5v-2" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
  <path d="m9 2.5-6 6L9 14M20 2.5l6 6-6 5.5" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>`,te=`<svg viewBox="0 0 18 18">
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="6" x2="15" y1="4" y2="4"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="6" x2="15" y1="9" y2="9"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="6" x2="15" y1="14" y2="14"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="3" x2="3" y1="4" y2="4"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="3" x2="3" y1="9" y2="9"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="3" x2="3" y1="14" y2="14"></line>
</svg>`,ne=`<svg viewBox="0 0 18 18">
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="7" x2="15" y1="4" y2="4"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="7" x2="15" y1="9" y2="9"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="7" x2="15" y1="14" y2="14"></line>
  <line stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" x1="2.5" x2="4.5" y1="5.5" y2="5.5"></line>
  <path fill="currentColor" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"></path>
  <path stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"></path>
  <path stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"></path>
</svg>`;var O=class{constructor(e){this.editor=e,this.container=null,this.buttons={}}create(){this.container=document.createElement("div"),this.container.className="overtype-toolbar",this.container.setAttribute("role","toolbar"),this.container.setAttribute("aria-label","Text formatting"),[{name:"bold",icon:Z,title:"Bold (Ctrl+B)",action:"toggleBold"},{name:"italic",icon:U,title:"Italic (Ctrl+I)",action:"toggleItalic"},{separator:!0},{name:"h1",icon:G,title:"Heading 1",action:"insertH1"},{name:"h2",icon:Q,title:"Heading 2",action:"insertH2"},{name:"h3",icon:J,title:"Heading 3",action:"insertH3"},{separator:!0},{name:"link",icon:X,title:"Insert Link (Ctrl+K)",action:"insertLink"},{name:"code",icon:Y,title:"Inline Code",action:"toggleCode"},{name:"codeBlock",icon:ee,title:"Code Block",action:"insertCodeBlock"},{separator:!0},{name:"bulletList",icon:te,title:"Bullet List",action:"toggleBulletList"},{name:"orderedList",icon:ne,title:"Numbered List",action:"toggleNumberedList"}].forEach(r=>{if(r.separator){let o=document.createElement("div");o.className="overtype-toolbar-separator",o.setAttribute("role","separator"),this.container.appendChild(o)}else{let o=this.createButton(r);this.buttons[r.name]=o,this.container.appendChild(o)}});let n=this.editor.element.querySelector(".overtype-wrapper");return n&&this.editor.element.insertBefore(this.container,n),this.container}createButton(e){let n=document.createElement("button");return n.className="overtype-toolbar-button",n.type="button",n.title=e.title,n.setAttribute("aria-label",e.title),n.setAttribute("data-action",e.action),n.innerHTML=e.icon,n.addEventListener("click",r=>{r.preventDefault(),this.handleAction(e.action)}),n}async handleAction(e){let n=this.editor.textarea;if(n){n.focus();try{let r;try{r=await Promise.resolve().then(()=>(z(),P))}catch(o){if(window.markdownActions)r=window.markdownActions;else throw new Error("markdown-actions not available")}switch(e){case"toggleBold":r.toggleBold(n);break;case"toggleItalic":r.toggleItalic(n);break;case"insertH1":r.insertHeader(n,1);break;case"insertH2":r.insertHeader(n,2);break;case"insertH3":r.insertHeader(n,3);break;case"insertLink":r.insertLink(n);break;case"toggleCode":r.toggleCode(n);break;case"insertCodeBlock":r.insertCodeBlock(n);break;case"toggleBulletList":r.toggleBulletList(n);break;case"toggleNumberedList":r.toggleNumberedList(n);break}n.dispatchEvent(new Event("input",{bubbles:!0}))}catch(r){console.error("Error loading markdown-actions:",r)}}}async updateButtonStates(){let e=this.editor.textarea;if(e)try{let n;try{n=await Promise.resolve().then(()=>(z(),P))}catch(o){if(window.markdownActions)n=window.markdownActions;else return}let r=n.getActiveFormats(e);Object.entries(this.buttons).forEach(([o,i])=>{let s=!1;switch(o){case"bold":s=r.includes("bold");break;case"italic":s=r.includes("italic");break;case"code":s=r.includes("code");break;case"bulletList":s=r.includes("bulletList");break;case"orderedList":s=r.includes("orderedList");break;case"h1":s=r.includes("header1");break;case"h2":s=r.includes("header2");break;case"h3":s=r.includes("header3");break}i.classList.toggle("active",s),i.setAttribute("aria-pressed",s.toString())})}catch(n){}}destroy(){this.container&&(this.container.remove(),this.container=null,this.buttons={})}};var d=class d{constructor(e,n={}){let r;if(typeof e=="string"){if(r=document.querySelectorAll(e),r.length===0)throw new Error(`No elements found for selector: ${e}`);r=Array.from(r)}else if(e instanceof Element)r=[e];else if(e instanceof NodeList)r=Array.from(e);else if(Array.isArray(e))r=e;else throw new Error("Invalid target: must be selector string, Element, NodeList, or Array");return r.map(i=>{if(i.overTypeInstance)return i.overTypeInstance.reinit(n),i.overTypeInstance;let s=Object.create(d.prototype);return s._init(i,n),i.overTypeInstance=s,d.instances.set(i,s),s})}_init(e,n={}){this.element=e,this.options=this._mergeOptions(n),this.instanceId=++d.instanceCount,this.initialized=!1,d.injectStyles(),d.initGlobalListeners();let r=e.querySelector(".overtype-wrapper");r?this._recoverFromDOM(r):this._buildFromScratch(),this.shortcuts=new T(this),this.options.toolbar&&(this.toolbar=new O(this),this.toolbar.create(),this.textarea.addEventListener("selectionchange",()=>{this.toolbar.updateButtonStates()}),this.textarea.addEventListener("input",()=>{this.toolbar.updateButtonStates()})),this.initialized=!0,this.options.onChange&&this.options.onChange(this.getValue(),this)}_mergeOptions(e){let n={fontSize:"14px",lineHeight:1.6,fontFamily:"'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace",padding:"16px",mobile:{fontSize:"16px",padding:"12px",lineHeight:1.5},autofocus:!1,placeholder:"Start typing...",value:"",onChange:null,onKeydown:null,showActiveLineRaw:!1,showStats:!1,toolbar:!1,statsFormatter:null},{theme:r,colors:o,...i}=e;return{...n,...i}}_recoverFromDOM(e){if(this.wrapper=e,this.textarea=e.querySelector(".overtype-input"),this.preview=e.querySelector(".overtype-preview"),!this.textarea||!this.preview){e.remove(),this._buildFromScratch();return}this.wrapper._instance=this,this.options.fontSize&&this.wrapper.style.setProperty("--instance-font-size",this.options.fontSize),this.options.lineHeight&&this.wrapper.style.setProperty("--instance-line-height",String(this.options.lineHeight)),this.options.padding&&this.wrapper.style.setProperty("--instance-padding",this.options.padding),this._configureTextarea(),this._applyOptions()}_buildFromScratch(){let e=this._extractContent();this.element.innerHTML="",this._createDOM(),(e||this.options.value)&&this.setValue(e||this.options.value),this._applyOptions()}_extractContent(){let e=this.element.querySelector(".overtype-input");return e?e.value:this.element.textContent||""}_createDOM(){this.wrapper=document.createElement("div"),this.wrapper.className="overtype-wrapper";let e=d.currentTheme||E,n=typeof e=="string"?e:e.name;n&&this.wrapper.setAttribute("data-theme",n),this.options.showStats&&this.wrapper.classList.add("with-stats"),this.options.fontSize&&this.wrapper.style.setProperty("--instance-font-size",this.options.fontSize),this.options.lineHeight&&this.wrapper.style.setProperty("--instance-line-height",String(this.options.lineHeight)),this.options.padding&&this.wrapper.style.setProperty("--instance-padding",this.options.padding),this.wrapper._instance=this,this.textarea=document.createElement("textarea"),this.textarea.className="overtype-input",this.textarea.placeholder=this.options.placeholder,this._configureTextarea(),this.preview=document.createElement("div"),this.preview.className="overtype-preview",this.preview.setAttribute("aria-hidden","true"),this.wrapper.appendChild(this.textarea),this.wrapper.appendChild(this.preview),this.options.showStats&&(this.statsBar=document.createElement("div"),this.statsBar.className="overtype-stats",this.wrapper.appendChild(this.statsBar),this._updateStats()),this.element.appendChild(this.wrapper)}_configureTextarea(){this.textarea.setAttribute("autocomplete","off"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.setAttribute("data-gramm","false"),this.textarea.setAttribute("data-gramm_editor","false"),this.textarea.setAttribute("data-enable-grammarly","false")}_applyOptions(){this.options.autofocus&&this.textarea.focus(),this.updatePreview()}updatePreview(){let e=this.textarea.value,n=this.textarea.selectionStart,r=this._getCurrentLine(e,n),o=A.parse(e,r,this.options.showActiveLineRaw);this.preview.innerHTML=o||'<span style="color: #808080;">Start typing...</span>',this._applyCodeBlockBackgrounds(),this.options.showStats&&this.statsBar&&this._updateStats(),this.options.onChange&&this.initialized&&this.options.onChange(e,this)}_applyCodeBlockBackgrounds(){let e=this.preview.querySelectorAll(".code-fence");for(let n=0;n<e.length-1;n+=2){let r=e[n],o=e[n+1],i=r.parentElement,s=o.parentElement;if(!i||!s)continue;r.style.display="block",o.style.display="block",i.classList.add("code-block-line"),s.classList.add("code-block-line");let a=i.nextElementSibling;for(;a&&a!==s&&(a.tagName==="DIV"&&a.classList.add("code-block-line"),a=a.nextElementSibling,!!a););}}_getCurrentLine(e,n){return e.substring(0,n).split(`
`).length-1}handleInput(e){this.updatePreview()}handleKeydown(e){!this.shortcuts.handleKeydown(e)&&this.options.onKeydown&&this.options.onKeydown(e,this)}handleScroll(e){this.preview.scrollTop=this.textarea.scrollTop,this.preview.scrollLeft=this.textarea.scrollLeft}getValue(){return this.textarea.value}setValue(e){this.textarea.value=e,this.updatePreview()}focus(){this.textarea.focus()}blur(){this.textarea.blur()}isInitialized(){return this.initialized}reinit(e={}){this.options=this._mergeOptions({...this.options,...e}),this._applyOptions(),this.updatePreview()}_updateStats(){if(!this.statsBar)return;let e=this.textarea.value,n=e.split(`
`),r=e.length,o=e.split(/\s+/).filter(c=>c.length>0).length,i=this.textarea.selectionStart,a=e.substring(0,i).split(`
`),l=a.length,m=a[a.length-1].length+1;this.options.statsFormatter?this.statsBar.innerHTML=this.options.statsFormatter({chars:r,words:o,lines:n.length,line:l,column:m}):this.statsBar.innerHTML=`
          <div class="overtype-stat">
            <span class="live-dot"></span>
            <span>${r} chars, ${o} words, ${n.length} lines</span>
          </div>
          <div class="overtype-stat">Line ${l}, Col ${m}</div>
        `}showStats(e){this.options.showStats=e,e&&!this.statsBar?(this.statsBar=document.createElement("div"),this.statsBar.className="overtype-stats",this.wrapper.appendChild(this.statsBar),this.wrapper.classList.add("with-stats"),this._updateStats()):!e&&this.statsBar&&(this.statsBar.remove(),this.statsBar=null,this.wrapper.classList.remove("with-stats"))}destroy(){if(this.element.overTypeInstance=null,d.instances.delete(this.element),this.shortcuts&&this.shortcuts.destroy(),this.wrapper){let e=this.getValue();this.wrapper.remove(),this.element.textContent=e}this.initialized=!1}static init(e,n={}){return new d(e,n)}static getInstance(e){return e.overTypeInstance||d.instances.get(e)||null}static destroyAll(){document.querySelectorAll("[data-overtype-instance]").forEach(n=>{let r=d.getInstance(n);r&&r.destroy()})}static injectStyles(e=!1){if(d.stylesInjected&&!e)return;let n=document.querySelector("style.overtype-styles");n&&n.remove();let r=d.currentTheme||E,o=K({theme:r}),i=document.createElement("style");i.className="overtype-styles",i.textContent=o,document.head.appendChild(i),d.stylesInjected=!0}static setTheme(e,n=null){let r=typeof e=="string"?M(e):e;n&&(r=D(r,n)),d.currentTheme=r,d.injectStyles(!0),document.querySelectorAll(".overtype-wrapper").forEach(o=>{let i=typeof r=="string"?r:r.name;i&&o.setAttribute("data-theme",i);let s=o._instance;s&&s.updatePreview()})}static initGlobalListeners(){d.globalListenersInitialized||(document.addEventListener("input",e=>{if(e.target&&e.target.classList&&e.target.classList.contains("overtype-input")){let n=e.target.closest(".overtype-wrapper"),r=n==null?void 0:n._instance;r&&r.handleInput(e)}}),document.addEventListener("keydown",e=>{if(e.target&&e.target.classList&&e.target.classList.contains("overtype-input")){let n=e.target.closest(".overtype-wrapper"),r=n==null?void 0:n._instance;r&&r.handleKeydown(e)}}),document.addEventListener("scroll",e=>{if(e.target&&e.target.classList&&e.target.classList.contains("overtype-input")){let n=e.target.closest(".overtype-wrapper"),r=n==null?void 0:n._instance;r&&r.handleScroll(e)}},!0),document.addEventListener("selectionchange",e=>{let n=document.activeElement;if(n&&n.classList.contains("overtype-input")){let r=n.closest(".overtype-wrapper"),o=r==null?void 0:r._instance;o&&(o.options.showStats&&o.statsBar&&o._updateStats(),clearTimeout(o._selectionTimeout),o._selectionTimeout=setTimeout(()=>{o.updatePreview()},50))}}),d.globalListenersInitialized=!0)}};B(d,"instances",new WeakMap),B(d,"stylesInjected",!1),B(d,"globalListenersInitialized",!1),B(d,"instanceCount",0);var L=d;L.MarkdownParser=A;L.ShortcutsManager=T;L.themes={solar:E,cave:M("cave")};L.getTheme=M;L.currentTheme=E;var Ge=L;return $e(Qe);})();
/**
 * OverType - A lightweight markdown editor library with perfect WYSIWYG alignment
 * @version 1.0.0
 * @license MIT
 */
window.OverType = OverType.OverType || OverType.default || OverType;
